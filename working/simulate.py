from optimizer import optimize_linear_cluster_path
from linear_witness import run_cluster_witness_theorem_2
from iqm.qiskit_iqm.iqm_provider import IQMProvider

#garnet data
edge_data = [([18, 17], 0.18368804661031968), ([9, 10], 0.29178665557484385), ([13, 12], 1.1162589543305956), ([18, 19], 0.12760287712831886), ([3, 4], 7.698242462739158), ([11, 10], 0.4849068709610771), ([13, 14], 0.9584088942435565), ([1, 4], 0.21131905149636143), ([13, 8], 0.4934355869787632), ([15, 10], 0.5757440802106051), ([9, 4], 0.5104884287033373), ([11, 6], 0.25524898234603466), ([13, 17], 0.42224936140939917), ([15, 19], 0.36463650336719944), ([7, 12], 0.6137507088124439), ([9, 14], 0.6632456296422617), ([11, 16], 0.39494925123836344), ([3, 8], 6.19555484287252), ([5, 10], 0.8317877542178387), ([18, 14], 0.39979274222825545), ([5, 4], 0.8913503940611966), ([7, 8], 1.2429394607743616), ([15, 14], 0.26519635616050197), ([1, 0], 0.2398695990178834), ([5, 6], 0.5416455042012602), ([9, 8], 1.0088600974843764), ([15, 16], 0.38932518390986104)]
node_cost = [(4, 3.4499999999999975), (16, 1.7750000000000044), (3, 7.325000000000004), (18, 1.8000000000000016), (11, 2.3249999999999993), (6, 1.4000000000000012), (13, 1.8000000000000016), (14, 3.2749999999999946), (12, 1.8750000000000044), (10, 2.849999999999997), (19, 1.375000000000004), (17, 1.5750000000000042), (15, 1.6750000000000043), (1, 1.1499999999999955), (0, 1.9499999999999962), (8, 6.25), (5, 2.4249999999999994), (7, 2.500000000000002), (2, 1.9000000000000017), (9, 1.9750000000000045)]

# emerald data
#edge_data = [([52, 53], 0.9155800964991245), ([3, 4], 1.8192316747080772), ([8, 7], 0.8837752740216809), ([12, 11], 0.9179964548055808), ([0, 4], 0.4257549737402777), ([17, 18], 0.2892841978012206), ([15, 7], 0.9855673254395625), ([24, 23], 0.7284042308198013), ([19, 11], 0.564546975788438), ([21, 13], 2.307193598446955), ([28, 27], 0.22167952116319833), ([24, 32], 0.5802886120780393), ([33, 34], 1.386738188299319), ([26, 34], 1.298701162486282), ([37, 38], 0.4757243476306794), ([28, 36], 0.4290387536496798), ([40, 39], 0.3029503978040027), ([44, 43], 0.3891400040439974), ([30, 38], 0.15279853480204553), ([47, 48], 0.26309781865180293), ([47, 41], 0.4781683165119399), ([5, 4], 0.7060813815400802), ([8, 9], 0.4725270605374421), ([43, 49], 7.441027613791384), ([8, 2], 0.1789868354317603), ([12, 13], 0.3124558953408352), ([15, 14], 0.8528258775608033), ([10, 4], 1.2190286433494846), ([15, 23], 0.7590435226697223), ([19, 18], 0.23497714522078272), ([17, 25], 1.287840147756203), ([24, 25], 0.42324688082245876), ([28, 29], 0.8232818908602946), ([19, 27], 0.6036426716165555), ([35, 34], 0.5154203254698619), ([21, 29], 3.828431211490979), ([40, 32], 0.8966610275229048), ([40, 41], 0.19168903490524025), ([44, 45], 0.9923925197859562), ([5, 6], 0.4204247051326382), ([34, 42], 1.507906821331917), ([10, 9], 0.6636227556801599), ([44, 36], 0.7065378485403784), ([47, 51], 0.937432189311882), ([15, 16], 0.49705311576799804), ([19, 20], 0.31972606602314046), ([49, 53], 1.3614456624297167), ([5, 1], 0.7347207561420821), ([25, 26], 0.9224362410974796), ([30, 29], 0.6561243117543025), ([8, 16], 0.8686489120027563), ([10, 18], 0.1844503641643791), ([31, 32], 0.35412621646764286), ([35, 36], 0.31000562740644), ([41, 42], 0.3146466929474956), ([12, 20], 1.446927754521643), ([49, 50], 0.8950663667080749), ([52, 51], 1.3691388044951625), ([31, 23], 0.6084517668385026), ([33, 25], 0.47185893050541994), ([35, 27], 1.105280334830916), ([40, 46], 0.8937829418373955), ([44, 50], 0.0857038840365365), ([3, 9], 0.5735334860861974), ([5, 11], 0.46191574895697585), ([22, 14], 0.21275771631790175), ([24, 16], 0.6479119798293964), ([18, 26], 1.060549061816396), ([28, 20], 3.992889730025484), ([33, 41], 0.6790866218461589), ([35, 43], 0.5091354090133837), ([52, 48], 0.19723307076128238), ([0, 1], 0.2323351364436177), ([3, 2], 1.2249253218507228), ([10, 11], 0.22812821171529496), ([17, 16], 0.6612857561426821), ([21, 20], 1.7297983852624599), ([22, 23], 0.33762959353725863), ([26, 27], 3.1258999408530386), ([33, 32], 0.2460590329208978), ([36, 37], 0.48785240074543657), ([47, 46], 0.3287896774973653)]
#node_cost = [(48, 1.375000000000004), (25, 1.2499999999999956), (52, 1.9750000000000045), (8, 2.100000000000002), (18, 1.849999999999996), (2, 1.8000000000000016), (21, 1.9000000000000017), (15, 1.0499999999999954), (32, 1.5750000000000042), (4, 2.749999999999997), (53, 3.774999999999995), (29, 2.1499999999999964), (10, 1.4249999999999985), (44, 1.7750000000000044), (6, 4.725000000000001), (31, 2.0750000000000046), (47, 1.924999999999999), (12, 1.7249999999999988), (42, 1.924999999999999), (30, 5.6499999999999995), (35, 1.6249999999999987), (46, 3.300000000000003), (43, 5.85), (23, 1.749999999999996), (1, 1.2499999999999956), (39, 2.3249999999999993), (13, 1.8249999999999988), (24, 2.275000000000005), (27, 4.174999999999995), (3, 9.299999999999997), (49, 2.0000000000000018), (16, 2.300000000000002), (28, 4.425000000000001), (34, 2.9750000000000054), (38, 2.5249999999999995), (33, 1.2249999999999983), (5, 0.8750000000000036), (9, 2.649999999999997), (40, 1.7249999999999988), (0, 2.1750000000000047), (51, 2.300000000000002), (45, 2.575000000000005), (11, 2.0499999999999963), (26, 1.375000000000004), (7, 1.275000000000004), (20, 1.3000000000000012), (19, 2.1750000000000047), (22, 1.2249999999999983), (36, 2.7249999999999996), (17, 1.100000000000001), (37, 2.124999999999999), (50, 5.449999999999999), (41, 2.3249999999999993), (14, 2.0750000000000046)]

# processing data
edge_data = [(u, v, w) for ([u, v], w) in edge_data]
edge_data = [(u, v, w) if u < v else (v, u, w) for (u, v, w) in edge_data]
node_cost = [i for (_, i) in sorted(node_cost)]

# get backend
provider = IQMProvider(
    "https://resonance.meetiqm.com",
    quantum_computer="garnet",
    token="kXL7TYp+aF382y0PoH+iJ9bfYPCbhwDt8fZCu7KHoaMBnBezagx+Q5zUHT1QCtkp",
)
backend = provider.get_backend()

for n in range(17, 19):
    # get optimized path
    path, edges, cost = optimize_linear_cluster_path(20, edge_data, node_cost, n, 60)
    edges = [[u, v] for (u, v, _) in edges]

    w, pA, pB = run_cluster_witness_theorem_2(n, backend, coupling_map=edges, initial_layout=path)
    print(f"N={n}: Witness = {w:.3f} (P_odd={pA:.2f}, P_even={pB:.2f})")
    # Expected for perfect state: W = 3 - 2(1+1) = -1.0
    # With noise, W will be closer to 0 (less negative)